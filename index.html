<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µì—­ê¸°ê¸° ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header h1 {
            color: #667eea;
            font-size: 2rem;
        }
        .header-buttons {
            display: flex;
            gap: 10px;
        }
        .sync-btn {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        .sync-btn:hover {
            background: #059669;
        }
        .sync-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .inventory-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #0ea5e9;
        }
        .inventory-title {
            font-size: 16px;
            font-weight: 700;
            color: #0c4a6e;
            margin-bottom: 15px;
        }
        .device-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .device-name {
            font-weight: 600;
            color: #374151;
        }
        .device-count {
            font-size: 20px;
            font-weight: 700;
            color: #0ea5e9;
        }
        .device-count.low {
            color: #ef4444;
        }
        .edit-inventory-btn {
            background: #f59e0b;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        .edit-inventory-btn:hover {
            background: #d97706;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.3);
            color: white;
        }
        .tab-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .content {
            display: none;
        }
        .content.active {
            display: block;
        }
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .card h2 {
            color: #1f2937;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .time-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        .device-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .device-input-group {
            background: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
        }
        .device-input-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }
        .device-input-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 700;
            text-align: center;
        }
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        .submit-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .alert-box {
            background: #fef3c7;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #92400e;
        }
        .info-box {
            background: #dbeafe;
            border: 2px solid #3b82f6;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1e40af;
        }
        .event-card {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .event-card:hover {
            border-color: #0284c7;
            box-shadow: 0 4px 12px rgba(2, 132, 199, 0.2);
        }
        .event-title {
            font-weight: 700;
            font-size: 16px;
            color: #0c4a6e;
            margin-bottom: 10px;
        }
        .event-info {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.6;
        }
        .rental-item {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        .rental-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .rental-title {
            font-weight: 700;
            font-size: 18px;
            color: #1f2937;
        }
        .rental-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .rental-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }
        .rental-badge.using {
            background: #fef3c7;
            color: #92400e;
        }
        .rental-badge.returned {
            background: #d1fae5;
            color: #065f46;
        }
        .device-list {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        @media (max-width: 768px) {
            .form-row, .device-selector, .inventory-grid, .time-selector {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>ğŸ™ï¸ í†µì—­ê¸°ê¸° ê´€ë¦¬</h1>
                <div class="header-buttons">
                    <button class="sync-btn" onclick="manualRefresh()" id="refreshBtn">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button class="sync-btn" onclick="syncTeamUp()" id="syncBtn">
                        ğŸ“… TeamUp ë™ê¸°í™”
                    </button>
                </div>
            </div>
            
            <div class="inventory-grid">
                <div class="inventory-card">
                    <div class="inventory-title">ğŸ†• ì‹ í˜• ëª¨ë¸ ì¬ê³ </div>
                    <div class="device-row">
                        <span class="device-name">ì†¡ì‹ ê¸°</span>
                        <span class="device-count" id="newTransmitterStock">-</span>
                    </div>
                    <div class="device-row">
                        <span class="device-name">ìˆ˜ì‹ ê¸°</span>
                        <span class="device-count" id="newReceiverStock">-</span>
                    </div>
                    <button class="edit-inventory-btn" onclick="alert('ì¬ê³  ìˆ˜ì • ê¸°ëŠ¥ (ì¶”í›„ ì¶”ê°€)')">ì¬ê³  ìˆ˜ì •</button>
                </div>
                
                <div class="inventory-card">
                    <div class="inventory-title">ğŸ“» êµ¬í˜• ëª¨ë¸ ì¬ê³ </div>
                    <div class="device-row">
                        <span class="device-name">ì†¡ì‹ ê¸°</span>
                        <span class="device-count" id="oldTransmitterStock">-</span>
                    </div>
                    <div class="device-row">
                        <span class="device-name">ìˆ˜ì‹ ê¸°</span>
                        <span class="device-count" id="oldReceiverStock">-</span>
                    </div>
                    <button class="edit-inventory-btn" onclick="alert('ì¬ê³  ìˆ˜ì • ê¸°ëŠ¥ (ì¶”í›„ ì¶”ê°€)')">ì¬ê³  ìˆ˜ì •</button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('teamup')">TeamUp</button>
            <button class="tab-btn" onclick="showTab('rental')">ìˆ˜ë™ì‹ ì²­</button>
            <button class="tab-btn" onclick="showTab('list')">ëª©ë¡</button>
        </div>

        <div id="teamup" class="content active">
            <div class="card">
                <h2>ğŸ“… TeamUp ì¼ì •</h2>
                <div class="info-box">
                    ğŸ’¡ TeamUp ìº˜ë¦°ë”ì™€ ì—°ë™ëœ ì¼ì • ëª©ë¡ì…ë‹ˆë‹¤. "TeamUp ë™ê¸°í™”" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ì¼ì •ì„ ê°€ì ¸ì˜¤ì„¸ìš”.
                </div>
                <div id="teamupEventsList"></div>
            </div>
        </div>

        <div id="rental" class="content">
            <div class="card">
                <h2>ì§ì ‘ ë°˜ì¶œ ì‹ ì²­</h2>
                <div class="alert-box">
                    ğŸ’¡ TeamUpì— ì—†ëŠ” ì¼ì •ì´ê±°ë‚˜ ê¸´ê¸‰í•œ ê²½ìš° ì—¬ê¸°ì„œ ì§ì ‘ ì‹ ì²­í•˜ì„¸ìš”.
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>ì‚¬ìš©ì ì´ë¦„ *</label>
                        <select id="userName">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ê·œì—°">ê·œì—°</option>
                            <option value="ë‹¤í˜„">ë‹¤í˜„</option>
                            <option value="ì†Œë‹´">ì†Œë‹´</option>
                            <option value="ì„±í›ˆ">ì„±í›ˆ</option>
                            <option value="ìŠ¹ì—°">ìŠ¹ì—°</option>
                            <option value="ìŠ¹í—Œ">ìŠ¹í—Œ</option>
                            <option value="ì•„ì˜">ì•„ì˜</option>
                            <option value="ì—ë¦¬ì¹´">ì—ë¦¬ì¹´</option>
                            <option value="ì˜ì•„">ì˜ì•„</option>
                            <option value="ìš°ë¹ˆ">ìš°ë¹ˆ</option>
                            <option value="ì€í˜œ">ì€í˜œ</option>
                            <option value="ì£¼í™”">ì£¼í™”</option>
                            <option value="í•˜ê²½">í•˜ê²½</option>
                            <option value="í˜œì›">í˜œì›</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ë°˜ì¶œ ìœ í˜• *</label>
                        <select id="rentalType">
                            <option value="í˜„ì¥í†µì—­">í˜„ì¥í†µì—­ (ì˜¤í”¼ìŠ¤ ë‚´)</option>
                            <option value="ì™¸ê·¼">ì™¸ê·¼</option>
                            <option value="êµ­ë‚´ ì¶œì¥">êµ­ë‚´ ì¶œì¥</option>
                            <option value="í•´ì™¸ ì¶œì¥">í•´ì™¸ ì¶œì¥</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ì‹œì‘ì¼ *</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œì¼ *</label>
                        <input type="date" id="endDate">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ì‹œì‘ ì‹œê°„ *</label>
                        <div class="time-selector">
                            <select id="startAmPm">
                                <option value="AM">ì˜¤ì „</option>
                                <option value="PM">ì˜¤í›„</option>
                            </select>
                            <select id="startHour">
                                <option value="9" selected>9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                            </select>
                            <select id="startMinute">
                                <option value="00" selected>00ë¶„</option>
                                <option value="30">30ë¶„</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ì¢…ë£Œ ì‹œê°„ *</label>
                        <div class="time-selector">
                            <select id="endAmPm">
                                <option value="AM">ì˜¤ì „</option>
                                <option value="PM" selected>ì˜¤í›„</option>
                            </select>
                            <select id="endHour">
                                <option value="6" selected>6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                            </select>
                            <select id="endMinute">
                                <option value="00" selected>00ë¶„</option>
                                <option value="30">30ë¶„</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì‚¬ìš© ì‚¬ìœ  *</label>
                    <textarea id="reason" rows="2" placeholder="ì›Œí¬ìƒµ, ì¶œì¥ ë“±"></textarea>
                </div>

                <h3 style="margin: 20px 0 15px 0; color: #374151;">ì‚¬ìš© ê¸°ê¸° ì„ íƒ</h3>
                <div class="device-selector">
                    <div class="device-input-group">
                        <label>ğŸ†• ì‹ í˜• ì†¡ì‹ ê¸°</label>
                        <input type="number" id="newTransmitter" min="0" value="0">
                    </div>
                    <div class="device-input-group">
                        <label>ğŸ†• ì‹ í˜• ìˆ˜ì‹ ê¸°</label>
                        <input type="number" id="newReceiver" min="0" value="0">
                    </div>
                    <div class="device-input-group">
                        <label>ğŸ“» êµ¬í˜• ì†¡ì‹ ê¸°</label>
                        <input type="number" id="oldTransmitter" min="0" value="0">
                    </div>
                    <div class="device-input-group">
                        <label>ğŸ“» êµ¬í˜• ìˆ˜ì‹ ê¸°</label>
                        <input type="number" id="oldReceiver" min="0" value="0">
                    </div>
                </div>

                <button class="submit-btn" onclick="submitRental()" id="submitBtn">ë°˜ì¶œ ì‹ ì²­í•˜ê¸°</button>
            </div>
        </div>

        <div id="list" class="content">
            <div class="card">
                <h2>ì „ì²´ ë°˜ì¶œ ëª©ë¡</h2>
                <div id="rentalList"></div>
            </div>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbygxNiQ5NOpl83EP0xrE8Wz2RFQPfYZns-KE3xUolt5ZpBflSrtYWJJcU2Ii54CH1mCRQ/exec';
        
        let inventory = {
            new_model: { transmitter: 4, receiver: 28 },
            old_model: { transmitter: 5, receiver: 31 }
        };
        let rentals = [];
        let teamupEvents = [];

        async function init() {
            try {
                const testResponse = await fetch(WEB_APP_URL + '?action=getInventory', {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                if (!testResponse.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                
                await loadInventory();
                await loadRentals();
                await loadTeamUpEvents();
                updateAllDisplays();
                console.log('âœ… ì„œë²„ ì—°ê²° ì„±ê³µ');
            } catch (error) {
                console.warn('âš ï¸ ì„œë²„ ì—°ê²° ì‹¤íŒ¨, ë”ë¯¸ ë°ì´í„° ì‚¬ìš©');
                initDummyData();
            }
        }

        function initDummyData() {
            teamupEvents = [
                {
                    eventId: '1',
                    title: 'KBR ì›Œí¬ìƒµ',
                    startDate: '2026-01-20T09:00:00',
                    endDate: '2026-01-20T17:00:00',
                    interpretType: 'í˜„ì¥í†µì—­',
                    assignee: 'ë‹¤í˜„'
                },
                {
                    eventId: '2',
                    title: 'G-Star ì¶œì¥',
                    startDate: '2026-01-22T08:00:00',
                    endDate: '2026-01-24T18:00:00',
                    interpretType: 'í•´ì™¸ ì¶œì¥',
                    assignee: 'ìŠ¹ì—°'
                },
                {
                    eventId: '3',
                    title: 'ë¸ë¼ì›¨ì–´ ëŒ€í‘œë‹˜ ë¯¸íŒ…',
                    startDate: '2026-01-23T14:00:00',
                    endDate: '2026-01-23T16:00:00',
                    interpretType: 'í˜„ì¥í†µì—­',
                    assignee: 'ì†Œë‹´'
                }
            ];
            updateAllDisplays();
        }

        async function loadInventory() {
            try {
                const response = await fetch(WEB_APP_URL + '?action=getInventory', {
                    method: 'GET',
                    redirect: 'follow'
                });
                const data = await response.json();
                if (data.success) inventory = data.inventory;
                updateInventoryDisplay();
            } catch (error) {
                console.error('ì¬ê³  ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        async function loadRentals() {
            try {
                const response = await fetch(WEB_APP_URL + '?action=getRentals', {
                    method: 'GET',
                    redirect: 'follow'
                });
                const data = await response.json();
                if (data.success) rentals = data.rentals;
            } catch (error) {
                console.error('ë°˜ì¶œ ê¸°ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        async function loadTeamUpEvents() {
            try {
                const response = await fetch(WEB_APP_URL + '?action=getTeamUpEvents', {
                    method: 'GET',
                    redirect: 'follow'
                });
                const data = await response.json();
                if (data.success) teamupEvents = data.events;
                updateTeamUpDisplay();
            } catch (error) {
                console.error('TeamUp ì´ë²¤íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
        }

        async function manualRefresh() {
            const btn = document.getElementById('refreshBtn');
            btn.textContent = 'â³ ë¡œë”©...';
            btn.disabled = true;
            
            await loadInventory();
            await loadRentals();
            await loadTeamUpEvents();
            updateAllDisplays();
            
            btn.textContent = 'ğŸ”„ ìƒˆë¡œê³ ì¹¨';
            btn.disabled = false;
        }

        async function syncTeamUp() {
            const btn = document.getElementById('syncBtn');
            btn.textContent = 'â³ ë™ê¸°í™”...';
            btn.disabled = true;
            
            try {
                const response = await fetch(WEB_APP_URL + '?action=syncTeamUp', {
                    method: 'GET',
                    redirect: 'follow'
                });
                const data = await response.json();
                if (data.success) {
                    alert(`âœ… ë™ê¸°í™” ì™„ë£Œ!\n\nì „ì²´ ì´ë²¤íŠ¸: ${data.total}ê°œ\nì €ì¥ëœ ì´ë²¤íŠ¸: ${data.count}ê°œ`);
                    await loadTeamUpEvents();
                } else {
                    alert('âŒ ë™ê¸°í™” ì‹¤íŒ¨: ' + data.error);
                }
            } catch (error) {
                alert('âŒ ë™ê¸°í™” ì˜¤ë¥˜: ' + error);
            }
            
            btn.textContent = 'ğŸ“… TeamUp ë™ê¸°í™”';
            btn.disabled = false;
        }

        function updateInventoryDisplay() {
            document.getElementById('newTransmitterStock').textContent = inventory.new_model.transmitter;
            document.getElementById('newReceiverStock').textContent = inventory.new_model.receiver;
            document.getElementById('oldTransmitterStock').textContent = inventory.old_model.transmitter;
            document.getElementById('oldReceiverStock').textContent = inventory.old_model.receiver;
        }

        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'list') updateRentalList();
        }

        function getDateTime(date, ampm, hour, minute) {
            let h = parseInt(hour);
            if (ampm === 'PM' && h !== 12) h += 12;
            if (ampm === 'AM' && h === 12) h = 0;
            const dt = new Date(date);
            dt.setHours(h, parseInt(minute), 0, 0);
            return dt.toISOString();
        }

        async function submitRental() {
            const user = document.getElementById('userName').value;
            const type = document.getElementById('rentalType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const startAmPm = document.getElementById('startAmPm').value;
            const startHour = document.getElementById('startHour').value;
            const startMinute = document.getElementById('startMinute').value;
            const endAmPm = document.getElementById('endAmPm').value;
            const endHour = document.getElementById('endHour').value;
            const endMinute = document.getElementById('endMinute').value;
            const reason = document.getElementById('reason').value.trim();
            
            const newTx = parseInt(document.getElementById('newTransmitter').value) || 0;
            const newRx = parseInt(document.getElementById('newReceiver').value) || 0;
            const oldTx = parseInt(document.getElementById('oldTransmitter').value) || 0;
            const oldRx = parseInt(document.getElementById('oldReceiver').value) || 0;

            if (!user || !startDate || !endDate || !reason) {
                alert('âŒ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (newTx + newRx + oldTx + oldRx === 0) {
                alert('âŒ ìµœì†Œ 1ê°œ ì´ìƒì˜ ê¸°ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const fullStartDate = getDateTime(startDate, startAmPm, startHour, startMinute);
            const fullEndDate = getDateTime(endDate, endAmPm, endHour, endMinute);

            const params = new URLSearchParams({
                action: 'addRental',
                user, startDate: fullStartDate, endDate: fullEndDate, reason,
                newTransmitter: newTx, newReceiver: newRx,
                oldTransmitter: oldTx, oldReceiver: oldRx, type
            });

            const btn = document.getElementById('submitBtn');
            btn.textContent = 'ì‹ ì²­ ì¤‘...';
            btn.disabled = true;

            try {
                await fetch(WEB_APP_URL + '?' + params.toString());
                alert('âœ… ë°˜ì¶œ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                document.getElementById('userName').value = '';
                document.getElementById('reason').value = '';
                document.getElementById('newTransmitter').value = '0';
                document.getElementById('newReceiver').value = '0';
                document.getElementById('oldTransmitter').value = '0';
                document.getElementById('oldReceiver').value = '0';
                
                await loadRentals();
                updateAllDisplays();
            } catch (error) {
                alert('âŒ ì‹ ì²­ ì˜¤ë¥˜: ' + error);
            }
            
            btn.textContent = 'ë°˜ì¶œ ì‹ ì²­í•˜ê¸°';
            btn.disabled = false;
        }

        function updateTeamUpDisplay() {
            const container = document.getElementById('teamupEventsList');
            
            if (teamupEvents.length === 0) {
                container.innerHTML = '<div class="loading">TeamUp ë™ê¸°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>';
                return;
            }

            container.innerHTML = teamupEvents.map(event => `
                <div class="event-card">
                    <div class="event-title">${event.title}</div>
                    <div class="event-info">
                        ğŸ“… ${new Date(event.startDate).toLocaleString('ko-KR', {month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'})} 
                        ~ ${new Date(event.endDate).toLocaleString('ko-KR', {month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'})}<br>
                        ğŸ¤ ${event.interpretType} | ğŸ‘¤ ${event.assignee || 'ë¯¸ì§€ì •'}
                    </div>
                </div>
            `).join('');
        }

        function updateRentalList() {
            const list = document.getElementById('rentalList');
            
            if (rentals.length === 0) {
                list.innerHTML = '<div class="loading">ë°˜ì¶œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            list.innerHTML = rentals.slice().reverse().map(rental => {
                const typeClass = (rental.type || '').replace(/ /g, '');
                return `
                <div class="rental-item">
                    <div class="rental-header">
                        <div class="rental-title">${rental.user} - ${rental.reason}</div>
                        <div class="rental-badges">
                            <span class="rental-badge ${rental.status === 'ì‚¬ìš©ì¤‘' ? 'using' : 'returned'}">${rental.status}</span>
                        </div>
                    </div>
                    <div style="font-size: 14px; color: #6b7280; margin-bottom: 10px;">
                        ğŸ“… ${new Date(rental.startDate).toLocaleString('ko-KR')} ~ ${new Date(rental.endDate).toLocaleString('ko-KR')}
                    </div>
                    <div class="device-list">
                        ${rental.newTransmitter > 0 ? `ğŸ†• ì‹ í˜• ì†¡ì‹ ê¸°: ${rental.newTransmitter}ëŒ€` : ''}
                        ${rental.newReceiver > 0 ? ` / ìˆ˜ì‹ ê¸°: ${rental.newReceiver}ëŒ€` : ''}
                        ${rental.oldTransmitter > 0 ? `<br>ğŸ“» êµ¬í˜• ì†¡ì‹ ê¸°: ${rental.oldTransmitter}ëŒ€` : ''}
                        ${rental.oldReceiver > 0 ? ` / ìˆ˜ì‹ ê¸°: ${rental.oldReceiver}ëŒ€` : ''}
                    </div>
                </div>
            `}).join('');
        }

        function updateAllDisplays() {
            updateInventoryDisplay();
            updateTeamUpDisplay();
            updateRentalList();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
            init();
        });
    </script>
</body>
</html>
